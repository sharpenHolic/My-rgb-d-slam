### version7 加入回环与关键帧

1. 关键帧的提取。把每一帧都拼到地图是去是不明智的。因为帧与帧之间距离很近，导致地图需要频繁更新，浪费时间与空间。所以，我们希望，当机器人的运动超过一定间隔，就增加一个“关键帧”。最后只需把关键帧拼到地图里就行了。
2. 回环的检测。回环的本质是识别曾经到过的地方。最简单的回环检测策略，就是把新来的关键帧与之前所有的关键帧进行比较，不过这样会导致越往后，需要比较的帧越多。所以，稍微快速一点的方法是在过去的帧里随机挑选一些，与之进行比较。更进一步的，也可以用图像处理/模式识别的方法计算图像间的相似性，对相似的图像进行检测。

关键流程：

1. 初始化关键帧序列：FF，并将第一帧f0f0放入FF。

2. 对于新来的一帧II，计算FF中最后一帧与II的运动，并估计该运动的大小ee。有以下几种可能性：

3. - 若e>Eerrore>Eerror，说明运动太大，可能是计算错误，丢弃该帧； 
   - 若没有匹配上（match太少），说明该帧图像质量不高，丢弃； 
   - 若e<Ekeye<Ekey，说明离前一个关键帧很近，同样丢弃；
   - 剩下的情况，只有是特征匹配成功，运动估计正确，同时又离上一个关键帧有一定距离，则把II作为新的关键帧，进入回环检测程序：

4. 近距离回环：匹配II与FF末尾mm个关键帧。匹配成功时，在图里增加一条边。

5. 随机回环：随机在FF里取nn个帧，与II进行匹配。若匹配上，在图里增加一条边。

6. 将II放入FF末尾。若有新的数据，则回2； 若无，则进行优化与地图拼接。